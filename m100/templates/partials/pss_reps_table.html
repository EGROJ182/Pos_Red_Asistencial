{% load static %}
{% load humanize %}

<!-- Contenedor principal para tabla de prestadores -->
<div id="medicamentos-table-container" class="container overflow-auto w-[90%] h-[70vh] bg-[#f3f4f562] rounded-xl shadow-xl relative z-10">
    <!-- Encabezados tabla principal-->
    <div class="sticky top-0 bg-[#f3f4f562] z-20 flex justify-between border-b border-gray-300 text-center font-bold min-w-[1024px]">
        <p class="w-[5%] py-2">#</p>
        <p class="w-[20%] py-2">NIT</p>
        <p class="w-[50%] py-2">Razón Social</p>
        <p class="w-[25%] py-2">Estado</p>
    </div>
    
    {% for prestador in prestadores %}
    <!-- Filas tabla principal-->
    <div class="flex items-center border-b border-gray-300 text-center min-w-[1024px] hover:bg-[#4aa5ff62] hover:font-semibold transition-colors duration-300 relative">
        <!-- Número de fila -->
        <div class="w-[5%] flex justify-between py-2 border-r border-gray-300 relative group">
            <p class="w-full py-2">{{ forloop.counter }}</p>
            <div class="absolute z-50 hidden group-hover:block bg-gray-100 shadow-lg rounded-lg text-[#333] font-bold px-2 py-2 border border-gray-300 group-hover:scale-y-100 transition-all duration-300 ease-in-out scale-y-0 origin-top"
                style="top: 0; left: 140%; transform: translateX(-50%);">
                <!-- Contenedor imagen sedes -->
                <div class="flex w-[50px] justify-center">
                    <img src="{% static 'resources/info2.gif' %}" alt="img-info" class="toggle-sedes h-10 cursor-pointer" data-nit="{{ prestador.nit }}">
                </div>
            </div>
        </div>
        
        <!-- Datos del prestador en la tabla principal -->
        <p class="w-[20%] py-2 border-r border-gray-300 hover-trigger">{{ prestador.nit }}</p>
        <div class="w-[50%] flex justify-center py-2 border-r border-gray-300 relative group">
            <p class="w-full py-2 text-[#333]">{{ prestador.nombre }}</p>
            <!-- Contador de sedes -->
            <div class="absolute z-50 items-center hidden w-[250px] group-hover:block bg-gray-100 shadow-lg rounded-lg text-[#333] font-bold px-4 py-2 border border-gray-300 group-hover:scale-y-100 transition-all duration-300 ease-in-out scale-y-0 origin-top"
                style="top: -30px; left: 50%; transform: translateX(-50%);">
                Cantidad de Sedes: {{ prestador.cantidad_sedes }}
            </div>
        </div>
        <div class="w-[25%] flex justify-center py-2 relative group">
            <p class="w-full py-2 text-[#333]">{{ prestador.nit }}</p>
            <div class="absolute z-50 items-center hidden w-[250px] group-hover:block bg-gray-100 shadow-lg rounded-lg text-[#333] font-bold px-4 py-2 border border-gray-300 group-hover:scale-y-100 transition-all duration-300 ease-in-out scale-y-0 origin-top"
                style="top: -30px; left: 50%; transform: translateX(-50%);">
                Contratos: {{ prestador.nit }}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="flex items-center border-b border-gray-300 text-center min-w-[1024px]">
        <p class="w-full py-4 text-center text-gray-500 italic">No se encontraron prestadores con los filtros aplicados</p>
    </div>
    {% endfor %}
</div>

<!-- Paneles modales superpuestos -->
<!-- Panel de sedes para cada prestador -->
{% for prestador in prestadores %}
<div id="sedes-{{ prestador.nit }}" class="informacion fixed inset-0 z-[9999] hidden flex-col bg-white shadow-2xl rounded-3xl text-[#333] p-6 border-2 border-blue-500 m-auto max-w-[90%] max-h-[90%] overflow-auto">
    <!-- Barra de título para sedes -->
    <div class="flex justify-between items-center mb-4 bg-white sticky top-0 z-[10000] pb-2 border-b-2 border-blue-300">
        <div class="flex w-[115px] justify-start space-x-2 text-black items-center">
            <img src="{% static 'resources/x.gif' %}" alt="img-close" class="close-sedes rounded-xl h-10 cursor-pointer" data-nit="{{ prestador.nit }}">
            <p class="close-sedes cursor-pointer font-semibold" data-nit="{{ prestador.nit }}">Cerrar</p>
        </div>
        
        <div class="flex-grow text-center text-blue-600 font-bold">
            <p class="option-img">Sedes de {{ prestador.nombre }} - {{ prestador.nit }}</p>
        </div>
        
        <div class="w-[115px]"></div> <!-- Espaciador para mantener el título centrado -->
    </div>

    <!-- Contenido de sedes -->
    <div class="w-full">
        <!-- Encabezados tabla sedes -->
        <div class="sticky top-16 bg-white flex justify-between text-center font-bold min-w-[1024px] border-b border-gray-300">
            <p class="w-[3%] py-2">#</p>
            <p class="w-[10%] py-2">Código H-S</p>
            <p class="w-[20%] py-2">Departamento</p>
            <p class="w-[20%] py-2">Municipio</p>
            <p class="w-[15%] py-2">Dirección</p>
            <p class="w-[10%] py-2">Télefono</p>
            <p class="w-[22%] py-2">Email</p>
        </div>
        
        <!-- <div class="flex items-center text-center bg-white border-b border-gray-200 hover:bg-[#4aa5ff62] hover:font-semibold transition-colors duration-300"> -->
        <!-- Listado de sedes del prestador -->
        {% for sede in prestador.sedes %}
        <div class="flex items-center border-b border-gray-300 text-center min-w-[1024px] hover:bg-[#ffa14a62] hover:font-semibold transition-colors duration-300 relative">
            <!-- Número de fila -->
            <div class="w-[3%] flex justify-between py-2 border-r border-gray-300 relative group">
                <p class="w-full py-2">{{ forloop.counter }}</p>
                <div class="absolute z-50 hidden group-hover:block bg-gray-100 shadow-lg rounded-lg text-[#333] font-bold px-2 py-2 border border-gray-300 group-hover:scale-y-100 transition-all duration-300 ease-in-out scale-y-0 origin-top"
                style="top: 0; left: 140%; transform: translateX(-50%);">
                    <!-- Botón para ver servicios -->
                    <div class="flex w-[50px] justify-center">
                        <img src="{% static 'resources/info2.gif' %}" alt="img-info" class="toggle-servicios h-10 cursor-pointer" data-sede-id="{{ sede.codigo_de_habilitacion }}-{{ sede.numero_sede }}">
                    </div>
                </div>
            </div>
            <p class="w-[10%] py-2 border-r border-gray-300">{{ sede.codigo_de_habilitacion }}-{{ sede.numero_sede }}</p>
            <p class="w-[20%] py-2 border-r border-gray-300">{{ sede.departamento }}</p>
            <p class="w-[20%] py-2 border-r border-gray-300">{{ sede.municipio }}</p>
            <p class="w-[15%] py-2 border-r border-gray-300">{{ sede.direccion }}</p>
            <p class="w-[10%] py-2 border-r border-gray-300">{{ sede.telefono }}</p>
            <p class="w-[22%] py-2 border-gray-300">{{ sede.email }}</p>
        </div>
        {% empty %}
        <div class="flex items-center text-center bg-white">
            <p class="w-full py-2 text-center text-gray-500 italic">No hay sedes registradas para este prestador</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endfor %}

<!-- Panel de servicios para cada sede de cada prestador -->
{% for prestador in prestadores %}
    {% for sede in prestador.sedes %}
    <div id="servicios-{{ sede.codigo_de_habilitacion }}-{{ sede.numero_sede }}" 
        class="informacion fixed inset-0 z-[9999] hidden flex-col bg-white shadow-2xl rounded-3xl text-[#333] p-6 border-2 border-orange-500 m-auto max-w-[90%] max-h-[90%] overflow-auto">
        
        <!-- Barra de título para servicios -->
        <div class="flex justify-between items-center mb-4 bg-white sticky top-0 z-[10000] pb-2 border-b-2 border-orange-300">
            <div class="flex w-[115px] justify-start space-x-2 text-black items-center">
                <img src="{% static 'resources/x.gif' %}" alt="img-close" class="close-servicios rounded-xl h-10 cursor-pointer" 
                    data-sede-id="{{ sede.codigo_de_habilitacion }}-{{ sede.numero_sede }}">
                <p class="close-servicios cursor-pointer font-semibold" 
                    data-sede-id="{{ sede.codigo_de_habilitacion }}-{{ sede.numero_sede }}">Cerrar</p>
            </div>
            
            <div class="flex-grow text-center text-orange-600 font-bold">
                <p class="option-img">Servicios de la Sede: {{ sede.sede_nombre }} 
                    ({{ sede.codigo_de_habilitacion }} # {{ sede.numero_sede }})</p>
            </div>
            
            <div class="w-[115px]"></div> <!-- Espaciador para mantener el título centrado -->
        </div>
        
        <!-- Contenido de servicios -->
        <div class="w-full">
            <!-- Encabezados tabla servicios -->
            <div class="sticky top-16 bg-white flex justify-between text-center font-bold min-w-[1024px] border-b border-gray-300">
                <p class="w-[5%] py-2">#</p>
                <p class="w-[15%] py-2">Código</p>
                <p class="w-[40%] py-2">Servicio</p>
                <p class="w-[10%] py-2">Grupo Cod.</p>
                <p class="w-[20%] py-2">Grupo</p>
                <p class="w-[10%] py-2">Complejidad</p>
            </div>
            
            <!-- <div class="flex items-center text-center bg-white border-b border-gray-200"> -->
            <!-- Listado de servicios de la sede -->
            {% for servicio in sede.servicios %}
            <div class="flex items-center border-b border-gray-300 text-center min-w-[1024px] hover:bg-[#4aa5ff62] hover:font-semibold transition-colors duration-300 relative">
                <p class="w-[5%] py-2 border-r border-gray-300">{{ forloop.counter }}</p>
                <p class="w-[15%] py-2 border-r border-gray-300">{{ servicio.serv_codigo }}</p>
                <p class="w-[40%] py-2 border-r border-gray-300">{{ servicio.serv_nombre }}</p>
                <p class="w-[10%] py-2 border-r border-gray-300">{{ servicio.grse_codigo }}</p>
                <p class="w-[20%] py-2 border-r border-gray-300">{{ servicio.grse_nombre }}</p>
                <p class="w-[10%] py-2 border-r border-gray-300">{{ servicio.complejidades }}</p>
            </div>
            {% empty %}
            <div class="flex items-center text-center bg-white">
                <p class="w-full py-2 text-center text-gray-500 italic">No hay servicios registrados para esta sede</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

<script src="{% static 'medicamentos/js/mas-info-reps.js' %}"></script>

{% endfor %}
