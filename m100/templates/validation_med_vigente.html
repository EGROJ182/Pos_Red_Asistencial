{% extends 'home.html' %}

{% block title %} {{ page_title }} {% endblock %}

{% block content %}
<meta name="csrf-token" content="{{ csrf_token }}">
<section class="content-view w-full py-0 bg-gray-50">
    
    <!-- Opciones HC Otros -->
    <div class="content-options flex flex-wrap space-x-4 space-y-0 p-0 m-0 py-0 px-0">
        <div class="relative ml-4 top-3 left-0"> 
            <a href="{% url 'moleculas-vigente' %}">
                <button type="button" class="options-med button-50">Consultas</button>
            </a>
        </div>
        <div class="relative ml-4 top-3 left-0">
            <a href="{% url 'validation-med-vigente' %}">
                <button type="button" class="options-med button-50">Validación</button>
            </a>
        </div>
        <div class="relative ml-4 top-3 left-0">
            <a href="{% url 'load-med-vigente' %}">
                <button type="button" class="options-med button-50">Cargue</button>
            </a>
        </div>
    </div>
    <!-- Contenedor cargue medicamentos -->
    <section class="content-data-load w-full py-20 bg-gray-100">
        <div class="container mx-auto px-4 shadow-lg py-4">
            <form id="form-cargar-excel" method="POST" enctype="multipart/form-data" action="{% url 'load-med-vigente' %}" onsubmit="handleFileSelect(event)">
                {% csrf_token %}
                <!-- Datos del acta adicionales -->
                <!-- <div class="relative justify-between columns-3 space-x-4">
                    <div class="relative z-0 mb-6 flex-1 min-w-[200px] border border-gray-300 rounded-md bg-white">
                        <input type="date" name="fecha_pactada" id="fecha_pactada" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-gray-100 border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " />
                        <label for="fecha_pactada" class="absolute font-medium text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 left-0 origin-[0_0] bg-gray-100 px-1 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-5 peer-focus:scale-75">Fecha Pactada</label>
                    </div>
                </div> -->
                <div class="relative inline-block w-64">
                    <label for="nombre_del_proveedor_pactado" class="block text-sm font-medium text-gray-700">Prestador</label>
                    <select id="nombre_del_proveedor_pactado" name="nombre_del_proveedor_pactado" class="mt-1 block w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-base text-gray-700 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500">
                        <option value="">Selecciona...</option>
                            {% for nombre in nombres.all %}
                                <option value="{{ nombre }}">{{ nombre }}</option>
                            {% endfor %}
                    </select>
                </div>
                <!-- <div class="relative inline-block w-64">
                    <label for="numero_acta_inicial" class="block text-sm font-medium text-gray-700">Estandar o # Acta</label>
                    <select name="numero_acta_inicial" id="numero_acta_inicial" class="mt-1 block w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-base text-gray-700 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500">
                        <option value="">Selecciona...</option>
                        {% for acta in numero_acta %}
                                <option value="{{ acta }}">{{ acta }}</option>
                            {% endfor %}
                    </select>
                </div> -->
                
                <!-- Btn Cargar Acta !-->
                <button type="submit" class="button-48" role="button"><span class="text">Validar CUMS</span></button>
            </form>
        </div>
    </section>
    <!-- Contenedor Información -->
    <section id="info-buttons" class="content-info w-full lg:w-3/10 py-4 bg-[#e5e8e8] shadow-lg">
        <div class="container mx-auto px-4 flex justify-between items-center">        
            <div class="flex-1">
                <!-- Aquí van los labels de span y botones -->
                <p>Registros Cargados para Consulta <span id="result-query" class="font-semibold">0</span></p>
            </div>
            <!-- Ver proveedores -->
            <div class="ml-4">
                <button class="button-pts" role="button">Ver PTS</button>
            </div>
            <!-- Descargar Estándar -->
            <div class="ml-4">
                <button class="button-pts" role="button">Ver Estándar</button>
            </div>
            <!-- Hacer consulta personalizada -->
            <div class="ml-4">
                <button class="button-pts" role="button">Query MySQL</button>
            </div>
        </div>
    </section>
    <!-- Contenedor Proveedores -->
    <section id="section-actas" class="content-div-actas w-full bg-transparent h-max-auto">
        <div class="content-actas container mx-auto px-4 py-4 h-full bg-transparent">
            <h3 class="title text-3xl font-bold text-center my-6">Prestadores de Tecnologías en Salud (Contratados)</h3>
            <div class="relative container grid columns-3 justify-between rounded-sm shadow-lg bg-transparent text-[14px] mx-auto px-4 items-center overflow-x-auto h-[67vh]">
                {% for pts in pts %}
                    <div class="acta-item p-4 border border-gray-300 shadow-lg mb-4">
                        <p><strong>NIT Proveedor:</strong> {{ pts.nit }}</p>
                        <p><strong>Proveedor:</strong> {{ pts.nombre }}</p>
                        <p><strong>Tipo de Proveedor:</strong> {{ pts.tipo_proveedor }}</p>
                        <p><strong>Número & Año Contrato:</strong> {{ pts.numero_contrato }} - {{ pts.year_contrato }}</p>
                    </div>
                {% endfor %}
            </div>
            <p class="subtitle text-[18px] w-full font-bold text-right my-6">Total Proveedores {{ pts|length }}</p>
        </div>
    </section>
    <!-- Contenedor Archivo a cargar a la base -->
    <section class="w-full py-4 shadow-xl flex justify-center items-center bg-[#f3f4f581]">
        <div class="content-load-med relative container mx-auto py-2 px-4 w-[90%] h-[70vh] bg-[#f3f4f562] rounded-xl shadow-xl">
            <!-- Cuadro para arrastrar y soltar o seleccionar archivo -->
            <h1 class="text-3xl font-bold text-left my-6">Validación de Medicamentos en Negociación (Vigente)</h1>
            <div class="relative container grid columns-3 justify-between mx-auto px-4 py-4 space-y-4 h-300px bg-transparent">
                <div id="drop-area" 
                    class="border-dashed border-4 border-gray-300 text-center w-full h-[200px] flex grid-flow-col justify-center items-center bg-white"
                    ondragover="event.preventDefault();" 
                    ondrop="handleDrop(event);" 
                    onclick="document.getElementById('file-input').click()">
                    <img src="../../static/resources/xls.gif" alt="xls" class="size-20">
                    <div class="w-[50%] h-full justify-center items-center content-rich flex flex-col">
                        <input id="file-input" type="file" name="file" accept=".xlsx, .xls" class="hidden" onchange="handleFileSelect(event)"/>
                        <p class="title-content-load text-center">Arrastra y suelta el archivo aquí o haz clic para seleccionarlo</p>
                    </div>
                </div>
                <!-- Aquí se mostrará el nombre del archivo seleccionado -->
                <p id="file-name" class="text-gray-600 font-semibold text-center"><span>Ningún archivo seleccionado</span></p>
                <!-- Spinner o animación de cargue -->
                <div id="loading-spinner" class="spinner-container hidden text-center justify-center content-center">
                    <div class="loader"></div>
                </div>
            </div>
        </div>
    </section>
    {% include 'partials/alert.html' %}
</section>
<!-- <script>
    const loadMedUrl = "{% url 'load-med-vigente' %}";
</script> -->
{% endblock %}