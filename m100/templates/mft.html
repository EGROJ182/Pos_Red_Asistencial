{% extends 'home.html' %}

{% block title %} {{ page_title }} {% endblock %}

{% block content %}
<section class="content-view w-full py-0 bg-gray-50">
    
    <!-- Opciones HC Otros -->
    <div class="content-options flex flex-wrap justify-center space-x-4 space-y-0 p-0 m-0 py-0 px-0">
        <div class="relative ml-4 top-3 left-0">
            <a href="https://positivacuida.positiva.gov.co/cas/login?" target="_blank" rel="noopener">
                <button type="button" class="options-med button-50">Cuida 2</button>
            </a>
        </div>
        <div class="relative ml-4 top-3 left-0">
            <a href="https://mft.positiva.gov.co/webclient/Login.xhtml" target="_blank" rel="noopener">
                <button type="button" class="options-med button-50">GoAnywhere</button>
            </a>
        </div>
        <div class="relative ml-4 top-3 left-0">
            <a href="https://www.positiva.gov.co/" target="_blank" rel="noopener">
                <button type="button" class="options-med button-50">Positiva</button>
            </a>
        </div>
    </div>
    <!-- Contenedor cargue medicamentos -->
    <section class="content-data-load w-full py-20 bg-gray-100">
        <div class="container mx-auto px-4 shadow-lg py-4">
            <form method="GET" action="{% url 'mft_browser' %}">
            <!--  AGREGADO: Mantener la ruta actual -->
            <input type="hidden" name="path" value="{{ ruta_actual }}">
            <!-- Aqu铆 van los filtros -->
            <div class="flex flex-wrap justify-between space-x-4">
                <div class="relative z-0 mb-6 flex-1 min-w-[200px] border border-gray-300 rounded-md bg-white">
                    <input type="text" name="search" id="search" value="{{ request.GET.search }}" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-gray-100 border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " />
                    <label for="search" class="absolute font-medium text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 left-0 origin-[0_0] bg-gray-100 px-1 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-5 peer-focus:scale-75">Query All</label>
                </div>
                <div class="relative z-0 mb-6 flex-1 min-w-[200px] border border-gray-300 rounded-md bg-white">
                    <!--  CAMBIADO: Agregado value para preservar filtro carpeta -->
                    <input type="text" name="folder" id="folder" value="{{ request.GET.folder }}" class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-gray-100 border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " />
                    <label for="folder" class="absolute font-medium text-sm text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 left-0 origin-[0_0] bg-gray-100 px-1 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-focus:-translate-y-5 peer-focus:scale-75">Nombre Carpeta</label>
                </div>
                <div class="relative inline-block w-64">
                    <label for="file_type" class="block text-sm font-medium text-gray-700">Extensiones</label>
                    <select id="file_type" name="file_type" class="mt-1 block w-full rounded-md border border-gray-300 bg-white py-2 px-3 text-base text-gray-700 focus:border-indigo-500 focus:outline-none focus:ring-indigo-500">
                        <option value="">Selecciona...</option>
                            {% for extension in tipos %}
                                <!--  CAMBIADO: Agregado selected para preservar selecci贸n -->
                                <option value="{{ extension }}" {% if request.GET.file_type == extension %}selected{% endif %}>{{ extension }}</option>
                            {% endfor %}
                    </select>
                </div>
            </div>
            
            <!-- Btn buscar !-->
            <button type="submit" class="button-48" role="button"><span class="text">Buscar</span></button>
            <!--  AGREGADO: Bot贸n limpiar filtros -->
            <a href="{% url 'mft_browser' %}?path={{ ruta_actual }}" class="button-48 ml-2 inline-block" role="button"><span class="text">Limpiar</span></a>
        </form>
        </div>
    </section>
    <!-- Contenedor Informaci贸n -->
    <section id="info-buttons" class="content-info w-full lg:w-3/10 py-2 space-y-4 bg-[#e5e8e8] shadow-lg">
        <details class="content-btn-historico justify-center mx-0 py-2 items-center text-black bg-white">
            <summary>Hist贸ricos</summary>
                <div class="content-btn-historico justify-center mx-0 py-2 items-center shadow-lg hover:scale-95">        
                    <a href="{% url 'otros-vigente' %}" class="btn-historico block py">Hist贸rico Vigente de Otros</a>
                    <a href="{% url 'moleculas-homeopatica' %}" class="btn-historico block py-2">Hist贸rico de Medicamentos Homeopatica</a>
                    <a href="{% url 'otros-homeopatica' %}" class="btn-historico block py-2">Hist贸rico de Otros Homeopatica</a>
                </div>
        </details>
        <div class="content-bar container mx-auto px-4 flex justify-between items-center">
            <div class="flex-1">
                <!-- Aqu铆 van los labels de span y botones -->
                <p>Carpetas encontrados <span id="result-query" class="font-semibold">{{ info_page.paginator.count }}</span></p>
                <p>Archivos encontradas <span id="result-query" class="font-semibold">{{ archivos.paginator.count }}</span></p>
                <p>Filtros Aplicados : 
                    <span class="font-semibold">
                        {% if filtros_aplicados %}
                        {{ filtros_aplicados|join:", " }}
                        {% else %}
                        Ning煤n filtro aplicado
                        {% endif %}
                    </span>
                </p>
                <p>Ultima Actualizaci贸n <span class="font-semibold">Conexi贸n SFTP Online</span></p>
            </div>
        </div>
    </section>
    <!-- Contenedor T铆tulo -->
    <section class="w-full py-4 bg-[#f3f4f562] rounded-xl">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center text-gray-800"> Explorador SFTP</h1>
            {% if error_message %}
            <div class="mt-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded" role="alert">
                <p class="font-bold">锔 Error</p>
                <p>{{ error_message }}</p>
            </div>
            {% endif %}
        </div>
    </section>
    <section class="content-navidad w-full lg:w-7/10 py-2">
        <!-- Contenedor SFTP - Carpetas y Archivos -->
        <section class="content-pagination-cups w-full py-4 px-4 flex gap-4 bg-[#f3f4f581]">
            <!-- Tabla de Carpetas -->
            <div class="overflow-x-auto w-[50%] bg-[#f3f4f562] rounded-xl shadow-xl">
                {% include 'partials/ftp_table_carpetas.html' %}
            </div>
            
            <!-- Tabla de Archivos -->
            <div class="overflow-x-auto w-[50%] bg-[#f3f4f562] rounded-xl shadow-xl">
                {% include 'partials/ftp_table_archivos.html' %}
            </div>
        </section>
    </section>
</section>

<script>
// Toggle para mostrar/ocultar filtros
document.getElementById('toggle-filters').addEventListener('click', function() {
    const filters = document.getElementById('filters');
    if (filters.style.display === 'none') {
        filters.style.display = 'block';
    } else {
        filters.style.display = 'none';
    }
});
</script>
{% endblock %}